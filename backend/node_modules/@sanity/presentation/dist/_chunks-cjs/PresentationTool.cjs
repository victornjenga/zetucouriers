"use strict";var e=require("react/jsx-runtime"),t=require("@sanity/client/csm"),n=require("@sanity/ui"),r=require("react"),i=require("sanity"),s=require("sanity/router"),a=require("styled-components"),o=require("./index.cjs"),c=require("@sanity/icons"),u=require("sanity/structure"),l=require("./DisplayedDocumentBroadcaster.cjs"),d=require("@sanity/preview-url-secret/without-secret-search-params"),p=require("framer-motion"),f=require("@sanity/preview-url-secret/create-secret"),m=require("fast-deep-equal"),h=require("path-to-regexp"),v=require("@sanity/preview-url-secret/define-preview-url"),g=require("suspend-react");function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}for(var x=y(m),b=[],w=0;w<256;++w)b.push((w+256).toString(16).slice(1));var j,k=new Uint8Array(16);function P(){if(!j&&!(j=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return j(k)}var S={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function E(e,t,n){if(S.randomUUID&&!t&&!e)return S.randomUUID();var r=(e=e||{}).random||(e.rng||P)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,t=0){return(b[e[t+0]]+b[e[t+1]]+b[e[t+2]]+b[e[t+3]]+"-"+b[e[t+4]]+b[e[t+5]]+"-"+b[e[t+6]]+b[e[t+7]]+"-"+b[e[t+8]]+b[e[t+9]]+"-"+b[e[t+10]]+b[e[t+11]]+b[e[t+12]]+b[e[t+13]]+b[e[t+14]]+b[e[t+15]]).toLowerCase()}(r)}const C=1e3,I=1e3,T=500,R=["handshake/syn","handshake/syn-ack","handshake/ack"],_=e=>R.some((t=>t===e)),z=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function D(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(_(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),u(e,"handshake/ack",{id:e.id}))}}const s=t=>{const r=t.data;if(!_(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),l(t,"channel/response",{responseTo:r.id},!1)}}};function a(t){if(z(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function o(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,o(t),function(e){e.id=E(),e.interval=window.setInterval((()=>{u(e,"handshake/syn",{id:e.id})}),T)}(t)):"connected"===n?(t.handler=s,r(t),function(e){if(o(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:I;e.heartbeat=window.setInterval((()=>{l(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{l(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),o(t))}function u(n,r,i){if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:E(),to:n.config.id,type:r};try{t?.postMessage(s,{targetOrigin:"*"})}catch{throw new Error(`Failed to postMessage '${s.id}' on '${e.id}'`)}}function l(n,r,i,s=!0){const a=E();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(s){const t=setTimeout((()=>{o.connectionId===n.id&&(window.removeEventListener("message",s,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${o.type}' on client '${e.id}' (ID: '${o.id}').`))}),C),s=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===o.id&&(window.removeEventListener("message",s,!1),clearTimeout(t))};window.addEventListener("message",s,!1)}try{t?.postMessage(o,{targetOrigin:e.targetOrigin})}catch{throw new Error(`Failed to postMessage '${o.id}' on client '${e.id}'`)}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(l(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{o(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");l(i,t,r)}))}}}var M,L,$,O;function U(e){let t=typeof e;return"object"===t&&(t=(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null"),"string"===t?`"${e}"`:"number"===t||"bigint"===t||"boolean"===t?`${e}`:t}function A(e,t,n,r,i){const s=i&&"input"in i?i.input:n.value,a=i?.expected??e.expects,o=i?.received??U(s),c={kind:e.kind,type:e.type,input:s,expected:a,received:o,message:`Invalid ${t}: ${a?`Expected ${a} but r`:"R"}eceived ${o}`,requirement:e.requirement,path:i?.path,issues:i?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly,skipPipe:r.skipPipe},u="schema"===e.kind,l=e.message??(d=e.reference,p=c.lang,O?.get(d)?.get(p))??(u?function(e){return $?.get(e)}(c.lang):null)??r.message??function(e){return L?.get(e)}(c.lang);var d,p;l&&(c.message="function"==typeof l?l(c):l),u&&(n.typed=!1),n.issues?n.issues.push(c):n.issues=[c]}function F(e){return"__proto__"!==e&&"prototype"!==e&&"constructor"!==e}var B=class extends Error{issues;constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function W(e,t,n){return"function"==typeof e.fallback?e.fallback(t,n):e.fallback}function q(e){return{kind:"schema",type:"boolean",reference:q,expects:"boolean",async:!1,message:e,_run(e,t){return"boolean"==typeof e.value?e.typed=!0:A(this,"type",e,t),e}}}function N(e,t){return{kind:"schema",type:"object",reference:N,expects:"Object",async:!1,entries:e,message:t,_run(e,t){const n=e.value;if(n&&"object"==typeof n){e.typed=!0,e.value={};for(const r in this.entries){const i=n[r],s=this.entries[r]._run({typed:!1,value:i},t);if(s.issues){const a={type:"object",origin:"value",input:n,key:r,value:i};for(const t of s.issues)t.path?t.path.unshift(a):t.path=[a],e.issues?.push(t);if(e.issues||(e.issues=s.issues),t.abortEarly){e.typed=!1;break}}s.typed||(e.typed=!1),(void 0!==s.value||r in n)&&(e.value[r]=s.value)}}else A(this,"type",e,t);return e}}}function V(e,...t){const n={kind:"schema",type:"optional",reference:V,expects:`${e.expects} | undefined`,async:!1,wrapped:e,_run(e,t){return void 0===e.value&&("default"in this&&(e.value=function(e,t,n){return"function"==typeof e.default?e.default(t,n):e.default}(this,e,t)),void 0===e.value)?(e.typed=!0,e):this.wrapped._run(e,t)}};return 0 in t&&(n.default=t[0]),n}function K(e){return{kind:"schema",type:"string",reference:K,expects:"string",async:!1,message:e,_run(e,t){return"string"==typeof e.value?e.typed=!0:A(this,"type",e,t),e}}}function G(e,t,n){const r=e._run({typed:!1,value:t},function(e){return{lang:e?.lang??M?.lang,message:e?.message,abortEarly:e?.abortEarly??M?.abortEarly,abortPipeEarly:e?.abortPipeEarly??M?.abortPipeEarly,skipPipe:e?.skipPipe}}(n));if(r.issues)throw new B(r.issues);return r.value}const H=/^([A-Za-z]+):([0-9]+)$/,J=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,X=/^([A-Za-z]+):([a-z0-9]+)$/;const Z=function(...e){return{...e[0],pipe:e,_run(t,n){for(let r=0;r<e.length;r++){t=e[r]._run(t,n);const i=e[r+1];if(n.skipPipe||t.issues&&(n.abortEarly||n.abortPipeEarly||"schema"===i?.kind||"transformation"===i?.kind)){t.typed=!1;break}}return t}}}(K(),function e(t,n){return{kind:"validation",type:"min_length",reference:e,async:!1,expects:`>=${t}`,requirement:t,message:n,_run(e,t){return e.typed&&e.value.length<this.requirement&&A(this,"length",e,t,{received:`${e.value.length}`}),e}}}(1)),Q=V(Z);function Y(e,t){return`${e}-${"string"==typeof t?t:JSON.stringify(t)}`}N({baseUrl:Z,dataset:Q,id:Z,path:Z,projectId:Q,tool:Q,type:Q,workspace:Q,isDraft:V(K())}),N({origin:Z,href:Z,data:V(function e(t,n,r){return{kind:"schema",type:"record",reference:e,expects:"Object",async:!1,key:t,value:n,message:r,_run(e,t){const n=e.value;if(n&&"object"==typeof n){e.typed=!0,e.value={};for(const r in n)if(F(r)){const i=n[r],s=this.key._run({typed:!1,value:r},t);if(s.issues){const a={type:"record",origin:"key",input:n,key:r,value:i};for(const t of s.issues)t.path=[a],e.issues?.push(t);if(e.issues||(e.issues=s.issues),t.abortEarly){e.typed=!1;break}}const a=this.value._run({typed:!1,value:i},t);if(a.issues){const s={type:"record",origin:"value",input:n,key:r,value:i};for(const t of a.issues)t.path?t.path.unshift(s):t.path=[s],e.issues?.push(t);if(e.issues||(e.issues=a.issues),t.abortEarly){e.typed=!1;break}}(!s.typed||!a.typed)&&(e.typed=!1),s.typed&&(e.value[s.value]=a.value)}}else A(this,"type",e,t);return e}}}(K(),function e(){return{kind:"schema",type:"unknown",reference:e,expects:"unknown",async:!1,_run:e=>(e.typed=!0,e)}}()))});const ee={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function te(e){return"Alt"===e.key}function ne(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const re=r.createContext(null);re.displayName="PanelsContext";const ie=a.styled.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,se=function({children:t,defaultSize:n=null,id:i,minWidth:s,maxWidth:a,order:o=0}){const c=r.useContext(re);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:u,registerElement:l,unregisterElement:d}=c,p=u(i);return r.useLayoutEffect((()=>(l(i,{id:i,type:"panel",defaultSize:n,maxWidth:a??null,minWidth:s??0,order:o}),()=>{d(i)})),[i,n,o,a,s,l,d]),e.jsx(ie,{style:p,children:t})},ae="presentation/panels",oe=()=>JSON.parse(localStorage.getItem(ae)||"{}"),ce=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function ue(){return r.useMemo((()=>{const e=(e,t)=>{const n=oe(),r=ce(e);(e=>{localStorage.setItem(ae,JSON.stringify(e))})({...n,[r]:t})};return{get:e=>{const t=oe(),n=ce(e);return Array.isArray(t[n])&&t[n].some((e=>null===e))?void 0:t[n]},set:e,setDebounced:ne(e,100)}}),[])}function le(e,t,n){const{maxWidth:r,minWidth:i}=e,s=null==r?100:r/n*100,a=i/n*100;return Math.min(s,Math.max(a,t))}function de(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function pe(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function fe(e){return"panel"===e.type}function me(e){return"resizer"===e.type}function he(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function ve(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let s=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],o=le(r,a,n);a!=o&&(s+=a-o,i[t]=o)}if("0.000"!==s.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:o}=r;o=o/n*100,null!=a&&(a=a/n*100);const c=Math.min(a??100,Math.max(o,i[t]+s));if(c!==i[t]&&(s-=c-i[t],i[t]=c,"0.000"===Math.abs(s).toFixed(3)))break}return i}const ge=a.styled.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,ye=function({children:t}){const n=r.useRef(null),[i,s]=r.useState(new Map),a=r.useMemo((()=>he(i).filter(fe)),[i]),[o,c]=r.useState([]),[u,l]=r.useState(null),d=r.useRef({elements:i,panels:a,widths:o}),p=r.useCallback((e=>({flexGrow:de(a,e,o),pointerEvents:null===u?void 0:"none"})),[u,a,o]),f=r.useCallback(((e,t)=>{s((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),m=r.useCallback((e=>{s((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),h=r.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=r.useCallback(((e,t)=>{const n=he(i),r=n.findIndex((t=>t.id===e)),s=i.get(e);if(!s||!me(s))return;const a=s.el.current;a&&(h.current={resizerIndex:r,panelBefore:n.reduce(((e,t,n)=>fe(t)&&n<r?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&fe(t)&&n>r?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:pe(t,a),resizerRect:a.getBoundingClientRect(),widths:d.current.widths},l(e))}),[i]),g=r.useCallback((()=>{l(null)}),[]),y=r.useCallback(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:r,dragOffset:s,panelBefore:a,panelAfter:o,resizerRect:u}=h.current;if(null==a||null==o)return;const l=i.get(e);if(!l||!me(l))return;const p=l.el.current;if(!p)return;const f=pe(t,p,s,u);if(0===f)return;const{widths:m}=d.current,v=function(e,t,n,r,i,s){const{panels:a,widths:o}=i,{widths:c}=s,u=c||o,l=[...u];{const i=e<0?r:n,s=u[a.findIndex((e=>e.id===i.id))],o=le(i,s+Math.abs(e),t);if(s===o)return u;e=e<0?s-o:o-s}let d=0,p=e<0?n:r,f=a.findIndex((e=>e.id===p.id));for(;;){const n=a[f],r=u[f],i=le(n,r-(Math.abs(e)-Math.abs(d)),t);if(r!==i&&(d+=r-i,l[f]=i,d.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--f<0)break}else if(++f>=a.length)break}return 0===d?u:(p=e<0?r:n,f=a.findIndex((e=>e.id===p.id)),l[f]=u[f]+d,l)}(f/n.current.getBoundingClientRect().width*100,r,a,o,d.current,h.current);m.some(((e,t)=>e!==v[t]))&&c(v)}),[i]);r.useLayoutEffect((()=>{d.current.elements=i,d.current.panels=a,d.current.widths=o}),[i,a,o]);const x=ue();r.useLayoutEffect((()=>{const{widths:e}=d.current;if(e.length===a.length)return;const t=x.get(a);if(t){const e=ve(a,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(a);c(n)}),[x,a]),r.useEffect((()=>{o.length&&x.setDebounced(a,o)}),[x,a,o]),r.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=d.current,n=ve(e,t,window.innerWidth);t.some(((e,t)=>e!==n[t]))&&c(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const b=r.useMemo((()=>({activeResizer:u,drag:y,getPanelStyle:p,registerElement:f,startDragging:v,stopDragging:g,unregisterElement:m})),[u,y,p,f,v,g,m]);return e.jsx(re.Provider,{value:b,children:e.jsx(ge,{ref:n,children:t})})};function xe(t){const{children:r,message:s,onRetry:a,onContinueAnyway:c,...u}=t,{t:l}=i.useTranslation(o.p),d=e.jsx(n.Button,{fontSize:1,mode:"ghost",onClick:a,text:l("error-card.retry-button.text")}),p=e.jsx(n.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:c,text:l("error-card.continue-button.text")});return e.jsx(n.Card,{height:"fill",...u,children:e.jsx(n.Flex,{align:"center",height:"fill",justify:"center",children:e.jsx(n.Container,{padding:4,sizing:"border",width:0,children:e.jsxs(n.Stack,{space:4,children:[e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Text,{size:1,weight:"semibold",children:l("error-card.title")}),e.jsx(n.Text,{muted:!0,size:1,children:s})]}),r,a&&c?e.jsxs(n.Inline,{space:2,children:[d,p]}):a?e.jsx(n.Box,{children:d}):c?e.jsx(n.Box,{children:p}):null]})})})})}function be(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const we=r.forwardRef((function(t,n){const{searchParams:r,...i}=t;return e.jsx(s.StateLink,{...i,ref:n,state:{type:void 0,_searchParams:Object.entries(r)},title:void 0})})),je=r.forwardRef((function(t,n){const{documentId:r,documentType:i,parentRefPath:a,template:o,searchParams:c,...u}=t;return e.jsx(s.StateLink,{...u,ref:n,state:{id:r,type:i,_searchParams:Object.entries(c)},title:void 0})}));function ke(t){const{children:n,onStructureParams:a,structureParams:o,searchParams:c,refs:l}=t,{state:d,resolvePathFromState:p}=s.useRouter(),f=i.useUnique(Object.fromEntries(d._searchParams||[])),m=r.useCallback((e=>`${p(d)}${be({...f,...e})}`),[p,f,d]),h=r.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:o,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,a=l?.find((e=>e._id===n||i.getPublishedId(e._id)===n));return a?e.jsx(s.StateLink,{...r,state:{id:n,type:a._type,_searchParams:Object.entries(c)}}):e.jsx("div",{...r})},BackLink:t=>e.jsx(we,{...t,searchParams:c}),ReferenceChildLink:t=>e.jsx(je,{...t,searchParams:c}),ParameterizedLink:()=>e.jsx(e.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{a({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:m})),[m,a,l,c,o]);return e.jsx(u.PaneRouterContext.Provider,{value:h,children:n})}const Pe=a.styled(u.PaneLayout)`
  height: 100%;
`,Se=a.styled(n.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,Ee=a.styled(n.Code)`
  white-space: pre-wrap;
`;function Ce(t){const{mainDocumentState:s,onStructureParams:a,searchParams:c,refs:l}=t,{t:d}=i.useTranslation(o.p),{devMode:p}=o.u(),f=r.useMemo((()=>l.filter((e=>i.getPublishedId(e._id)!==s?.document?._id)).map((e=>e._id))),[s,l]),m=r.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:f}},schemaTypeName:"",title:d("document-list-pane.document-list.title"),type:"documentList"})),[f,d]),[h,v]=r.useState(null),g=r.useCallback((()=>v(null)),[]),[y]=r.useState((()=>({})));return r.useEffect((()=>v(null)),[l]),h?e.jsx(xe,{flex:1,message:d("document-list-pane.error.text"),onRetry:g,children:p&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:d("presentation-error.label")}),e.jsx(Ee,{size:1,children:h.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:v,children:e.jsx(Pe,{children:e.jsx(u.StructureToolProvider,{children:e.jsx(ke,{onStructureParams:a,structureParams:y,searchParams:c,refs:l,children:e.jsx(Se,{direction:"column",flex:1,children:e.jsx(u.DocumentListPane,{index:0,itemId:"$root",pane:m,paneKey:"$root"})})})})})})}const Ie=a.styled(n.Code)`
  white-space: pre-wrap;
`;function Te(t){const{documentId:a,documentType:c,onFocusPath:l,onStructureParams:d,searchParams:p,structureParams:f}=t,{template:m,templateParams:h}=f,{t:v}=i.useTranslation(o.p),{devMode:g}=o.u(),y=r.useMemo((()=>({id:a,options:{id:a,type:c,template:m,templateParameters:s.decodeJsonParams(h)},title:"",type:"document"})),[a,c,m,h]),[x,b]=r.useState(null),w=r.useCallback((()=>b(null)),[]);return r.useEffect((()=>{b(null)}),[a,c,f]),x?e.jsx(xe,{flex:1,message:v("document-pane.error.text"),onRetry:w,children:g&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:v("presentation-error.label")}),e.jsx(Ie,{size:1,children:x.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:b,children:e.jsx(u.PaneLayout,{style:{height:"100%"},children:e.jsx(ke,{searchParams:p,onStructureParams:d,structureParams:f,children:e.jsx(u.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:y,onFocusPath:l})})})})}function Re(t){const{documentId:n,documentType:r,onFocusPath:i,onStructureParams:s,searchParams:a,structureParams:o}=t;return e.jsx(u.StructureToolProvider,{children:e.jsx(Te,{documentId:n,documentType:r,onFocusPath:i,onStructureParams:s,searchParams:a,structureParams:o})})}function _e(t){const{documentId:a,documentType:u,mainDocumentState:l,onFocusPath:d,onStructureParams:p,refs:f,searchParams:m,structureParams:h}=t,{t:v}=i.useTranslation(o.p),g=i.useSchema(),y=r.useCallback((t=>e.jsx(s.StateLink,{...t,state:{id:l.document._id,type:l.document._type,_searchParams:Object.entries(m)}})),[l,m]),x=r.useMemo((()=>g.get(l?.document?._type||"shoe")),[l,g]),b=function(e,t){const n=i.useDocumentPreviewStore(),[s,a]=r.useState({});return r.useEffect((()=>{if(!t)return;const r=i.getPreviewStateObservable(n,t,e,"").subscribe((e=>{a(e)}));return()=>{r?.unsubscribe()}}),[n,t,e]),s}(l?.document?._id||"",x),w=r.useMemo((()=>l?.document?e.jsx(i.SanityDefaultPreview,{...i.getPreviewValueWithFallback({value:l.document,published:b.published,draft:b.draft}),schemaType:x,status:e.jsx(n.Card,{padding:1,radius:2,shadow:1,children:e.jsx(n.Text,{muted:!0,size:0,weight:"medium",children:v("main-document.label")})})}):null),[l,x,v,b]);return a&&u?e.jsx(Re,{documentId:a,documentType:u,onFocusPath:d,onStructureParams:p,searchParams:m,structureParams:h}):e.jsxs(n.Flex,{direction:"column",flex:1,height:"fill",children:[l&&e.jsx(n.Card,{padding:3,tone:l.document?"inherit":"caution",children:l.document?e.jsx(i.PreviewCard,{__unstable_focusRing:!0,as:y,"data-as":"a",radius:2,sizing:"border",tone:"inherit",children:w}):e.jsx(n.Card,{padding:2,radius:2,tone:"inherit",children:e.jsxs(n.Flex,{gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:e.jsx(c.WarningOutlineIcon,{})})}),e.jsx(n.Box,{flex:1,children:e.jsx(n.Text,{size:1,children:e.jsx(i.Translate,{t:v,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:l.path}})})})]})})}),e.jsx(Ce,{mainDocumentState:l,onStructureParams:p,searchParams:m,refs:f})]})}const ze=a.styled.div`
  position: relative;
`,De=a.styled.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,Me=function({id:t,order:n,disabled:i=!1}){const s=r.useRef(null),a=r.useContext(re);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const o=function(e){return r.useRef(e||E()).current}(t),{activeResizer:c,drag:u,startDragging:l,stopDragging:d,registerElement:p,unregisterElement:f}=a,m=c===o;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const h=r.useCallback((e=>{l(o,e.nativeEvent)}),[o,l]),v=r.useCallback((e=>{u(o,e)}),[o,u]),g=r.useCallback((()=>{s.current.blur(),d()}),[d]);return r.useEffect((()=>{if(!m||i)return;const e=function(){const e=document.body.style,t=document.documentElement.style,{cursor:n}=t,{userSelect:r}=e;return t.cursor="ew-resize",e.userSelect="none",()=>{n?t.cursor=n:t.removeProperty("cursor"),r?e.userSelect=r:e.removeProperty("user-select")}}();return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),window.addEventListener("contextmenu",g),()=>{e(),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g),window.removeEventListener("contextmenu",g)}}),[i,m,v,g]),r.useLayoutEffect((()=>(p(o,{id:o,order:n,type:"resizer",el:s}),()=>{f(o)})),[o,n,p,f]),e.jsx(ze,{onMouseDown:h,ref:s,children:e.jsxs(De,{$disabled:i,children:[e.jsx("span",{}),e.jsx("span",{})]})})},Le=t=>{const{documentId:n,setDisplayedDocument:r,getCommentIntent:s}=t;return e.jsxs(e.Fragment,{children:[e.jsx(Me,{order:4}),e.jsx(se,{id:"content",minWidth:325,order:5,children:e.jsx(l.D,{documentId:n,setDisplayedDocument:r,children:e.jsx(i.CommentsIntentProvider,{getIntent:s,children:t.children})})})]})},$e=t=>{const{documentId:n,documentsOnPage:r,documentType:i,getCommentIntent:s,mainDocumentState:a,onFocusPath:o,onStructureParams:c,searchParams:u,setDisplayedDocument:l,structureParams:d}=t;return e.jsx(Le,{documentId:n,getCommentIntent:s,setDisplayedDocument:l,children:e.jsx(_e,{documentId:n,documentType:i,mainDocumentState:a,onFocusPath:o,onStructureParams:c,refs:r,searchParams:u,structureParams:d})})},Oe=function(t){const{children:n,navigate:i}=t,s=r.useCallback(((e,t=void 0)=>{i(t||{},e?{preview:e}:{})}),[i]);return e.jsx(o.P.Provider,{value:s,children:n})};function Ue(t){const{unstable_navigator:n}=t,i=!!n?.component,[s,a]=function(e,t){const[n,i]=r.useState((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return r.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,i]}("presentation/navigator",i),o=!!i&&s,c=r.useMemo((()=>{if(i)return()=>a((e=>!e))}),[i,a]),u=r.useCallback((function(){return e.jsx(e.Fragment,{children:o&&e.jsx(Ae,{...n})})}),[o,n]);return[{navigatorEnabled:o,toggleNavigator:c},u]}const Ae=r.memo((function(t){const{minWidth:n,maxWidth:r,component:i}=t,s=null!=n&&null!=r&&n===r;return e.jsxs(e.Fragment,{children:[e.jsx(se,{id:"navigator",minWidth:n,maxWidth:r,order:1,children:e.jsx(i,{})}),e.jsx(Me,{order:2,disabled:s})]})})),Fe=function(t){const{children:n,params:i}=t,s=r.useMemo((()=>i),[i]);return e.jsx(o.a.Provider,{value:s,children:n})},Be=function(t){const{children:n,devMode:i,name:s,navigate:a,params:c,searchParams:u,structureParams:l}=t,d=r.useMemo((()=>({devMode:i,name:s,navigate:a,params:c,searchParams:u,structureParams:l})),[i,s,a,c,u,l]);return e.jsx(o.b.Provider,{value:d,children:n})},We="ACTION_IFRAME_LOADED",qe="ACTION_IFRAME_REFRESH",Ne="ACTION_IFRAME_RELOAD",Ve="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",Ke=(e,t)=>{switch(t.type){case We:return"loaded"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"loaded"}};case qe:return"refreshing"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"refreshing"}};case Ne:return"reloading"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"reloading"}};case Ve:return Ge(e,t);default:return e}},Ge=(e,t)=>e.visualEditing.overlaysEnabled===t.enabled?e:{...e,visualEditing:{...e.visualEditing,overlaysEnabled:t.enabled}},He=(Qe=q(),Ye=!1,{...Qe,fallback:Ye,_run(e,t){return Qe._run(e,t),e.issues?{typed:!0,value:W(this,e,t)}:e}}),Je=function e(t,n){return{kind:"schema",type:"picklist",reference:e,expects:t.map(U).join(" | ")||"never",async:!1,options:t,message:n,_run(e,t){return this.options.includes(e.value)?e.typed=!0:A(this,"type",e,t),e}}}(["loading","loaded","refreshing","reloading"]),Xe=N({mainDocument:He,iframe:N({status:Je}),visualEditing:N({overlaysEnabled:q()})}),Ze={mainDocument:!1,iframe:{status:"loading"},visualEditing:{overlaysEnabled:!1}};var Qe,Ye;function et(e){return G(Xe,{...Ze,...e})}const tt=p.motion(a.styled.iframe`
  box-shadow: 0 0 0 1px var(--card-border-color);
  border-top: 1px solid transparent;
  border-bottom: 0;
  border-right: 0;
  border-left: 0;
  max-height: 100%;
  width: 100%;
`),nt=a.styled(n.Box)`
  position: absolute;
  inset: 0;
  background: transparent;
`,rt=r.forwardRef((function(t,n){const{animate:r,initial:i,onLoad:s,preventClick:a,src:o,variants:c}=t;return e.jsxs(e.Fragment,{children:[e.jsx(tt,{animate:r,initial:i,onLoad:s,ref:n,src:o,variants:c}),a&&e.jsx(nt,{})]})})),it=function(t){const{fontSize:s=1,onChange:a,origin:u,padding:l=3,prefix:d,suffix:p,value:f}=t,{t:m}=i.useTranslation(o.p),{basePath:h="/"}=i.useActiveWorkspace()?.activeWorkspace||{},v=r.useRef(null),[g,y]=r.useState(void 0),[x,b]=r.useState(void 0),w=r.useCallback((e=>{y(e.currentTarget.value)}),[]),j=r.useCallback((e=>{if("Enter"===e.key){if(void 0===g)return;const e=g.startsWith("/")||""===g?`${u}${g}`:g;if(!e.startsWith(u+"/")&&e!==u)return void b(m("preview-location-input.error",{origin:u,context:"missing-origin"}));if(!u&&(e.startsWith(`${h}/`)||e===h))return void b(m("preview-location-input.error",{basePath:h,context:"same-base-path"}));const t=e===u?u+"/":e;b(void 0),y(void 0),a(t.slice(u.length)),v.current?.blur()}"Escape"===e.key&&(b(void 0),y(void 0))}),[h,a,u,g,m]),k=r.useCallback((()=>{b(void 0),y(void 0)}),[]);r.useEffect((()=>{b(void 0),y(void 0)}),[u,f]);const P=r.useMemo((()=>({icon:c.ResetIcon})),[]);return e.jsx(e.Fragment,{children:e.jsx(n.TextInput,{clearButton:x?P:void 0,customValidity:x,fontSize:s,onBlur:k,onClear:()=>{b(void 0),y(u+f)},onChange:w,onKeyDownCapture:j,padding:l,prefix:d,style:{zIndex:1},radius:2,ref:v,space:l,suffix:p,value:void 0===g?`${u}${f}`:g})})};function st(t){const{initialUrl:s,openPopup:a,previewLocationOrigin:u,previewLocationRoute:l}=t,{t:d}=i.useTranslation(o.p),p=r.useCallback((e=>{e.preventDefault(),a(e.currentTarget.href)}),[a]);return e.jsxs(e.Fragment,{children:[e.jsx(at,{initialUrl:s,previewLocationOrigin:u,previewLocationRoute:l}),e.jsx(n.MenuItem,{icon:c.LaunchIcon,text:d("share-url.menu-item.open.text"),as:"a",href:`${u}${l}`,onClick:p,rel:"opener",target:"_blank"})]})}function at(t){const{initialUrl:s,previewLocationOrigin:a,previewLocationRoute:u}=t,{t:l}=i.useTranslation(o.p),{push:p}=n.useToast(),m=i.useClient({apiVersion:o.A}),h=i.useCurrentUser(),[v,g]=r.useState(!1);return e.jsx(n.MenuItem,{disabled:v,onClick:()=>{if(!navigator?.clipboard)return p({closable:!0,status:"error",title:l("share-url.clipboard.status",{context:"unsupported"})}),!1;let e;g(!0);const t=`${a}${u}`,n=()=>{p({id:e,closable:!0,status:"success",title:l("share-url.clipboard.status",{context:"success"})}),g(!1)},r=e=>{p({closable:!0,status:"error",title:l("share-url.clipboard.status",{context:"failed"}),description:e.message||e.toString()}),g(!1)};if(d.hasSecretSearchParams(s)){const t=async()=>{e=p({closable:!0,title:l("share-url.clipboard.status",{context:"copying"})});const t=await f.createPreviewSecret(m,"@sanity/presentation",typeof window>"u"?"":location.href,h?.id);return d.setSecretSearchParams(s,t.secret,u).toString()};if(typeof ClipboardItem<"u"){const e="text/plain",i=new ClipboardItem({[e]:t().then((t=>new Blob([t],{type:e})))});navigator.clipboard.write([i]).then(n).catch(r)}else t().then((e=>navigator.clipboard.writeText(e))).then(n).catch(r)}else navigator.clipboard.writeText(t).then(n).catch(r)},text:l("share-url.menu-item.copy.text"),icon:c.CopyIcon})}const ot=p.motion(n.Flex),ct={previewDrafts:"preview-frame.perspective.previewDrafts.title",published:"preview-frame.perspective.published.title"},ut="caution",lt="positive",dt={previewDrafts:c.EditIcon,published:c.PublishIcon},pt=r.forwardRef((function(t,s){const{dispatch:a,iframe:u,initialUrl:l,loadersConnection:f,navigatorEnabled:m,onPathChange:h,onRefresh:v,openPopup:g,overlaysConnection:y,perspective:x,previewUrl:b,setPerspective:w,setViewport:j,targetOrigin:k,toggleNavigator:P,toggleOverlay:S,viewport:E,visualEditing:{overlaysEnabled:C}}=t,{t:I}=i.useTranslation(o.p),{devMode:T}=o.u(),R=n.usePrefersReducedMotion(),_=r.useCallback((()=>j("desktop"===E?"mobile":"desktop")),[j,E]),z="loading"===u.status||"reloading"===u.status,[D,M]=r.useState(!1),L="refreshing"===u.status,[$,O]=r.useState(!1),U=z||L||"connecting"===y,A=r.useMemo((()=>k===location.origin?"":k),[k]),F=r.useCallback((()=>{v((()=>{"function"==typeof s||!s?.current||(a({type:Ne}),s.current.src=`${k}${b||"/"}`)}))}),[a,v,b,k,s]),B=r.useCallback((()=>{"function"==typeof s||!s?.current||(s.current.src=l.toString(),a({type:Ne}))}),[a,s,l]),W=r.useCallback((()=>{N(!0)}),[]),[q,N]=r.useState(!1),[V,K]=r.useState(!1);r.useEffect((()=>{if(!(z||L||"connecting"!==y&&"reconnecting"!==y)){const e=setTimeout((()=>{K(!0)}),1e3);return()=>clearTimeout(e)}}),[y,z,L]),r.useEffect((()=>{if(!z&&!L&&V){if("connected"===y&&(O(!1),K(!1),M(!1),N(!1)),"connecting"===y){const e=setTimeout((()=>{M(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")}),o.M);return()=>clearTimeout(e)}if("reconnecting"===y){const e=setTimeout((()=>{M(!0),O(!0)}),o.M);return()=>clearTimeout(e)}"disconnected"===y&&O(!0)}}),[z,y,L,V]);const G=r.useMemo((()=>{const e=new URL(b||"/",k),{pathname:t,search:n}=d.withoutSecretSearchParams(e);return`${t}${n}`}),[b,k]),H=r.useCallback((()=>{a({type:We})}),[a]);r.useEffect((()=>{if("function"==typeof s||!s?.current)return;const e=s.current;function t(){e===document.activeElement&&e.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))}return window.addEventListener("blur",t),()=>{window.removeEventListener("blur",t)}}),[s]);const J=r.useMemo((()=>(z||"connecting"===y&&"refreshing"!==u.status)&&!q),[q,u.status,z,y]),X=r.useMemo((()=>[J?"background":"active",z?"reloading":"idle",E,V&&!q?"timedOut":""]),[q,z,J,V,E]);return e.jsx(p.MotionConfig,{transition:R?{duration:0}:void 0,children:e.jsxs(n.TooltipDelayGroupProvider,{delay:1e3,children:[e.jsx(n.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:e.jsxs(n.Flex,{align:"center",style:{minHeight:0},children:[P&&e.jsx(n.Box,{flex:"none",marginRight:1,padding:1,children:e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:I("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":I("preview-frame.navigator.toggle-button.aria-label"),fontSize:1,icon:c.PanelLeftIcon,mode:"bleed",onClick:P,padding:2,selected:m})})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsxs(n.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:[e.jsx(n.Box,{padding:1,children:e.jsx(n.Text,{size:1,children:I("preview-frame.overlay.toggle-button.tooltip",{context:C?"disable":"enable"})})}),e.jsx(n.Box,{paddingY:1,children:e.jsx(i.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e.jsx(n.Card,{as:"label",flex:"none",marginRight:1,padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:C?"transparent":void 0,children:e.jsxs(n.Flex,{align:"center",gap:3,children:[e.jsx("div",{style:{margin:-4},children:e.jsx(n.Switch,{checked:C,onChange:S,disabled:"loading"===u.status||"connected"!==y})}),e.jsx(n.Box,{children:e.jsx(n.Text,{muted:!C,size:1,weight:"medium",children:I("preview-frame.overlay.toggle-button.text")})})]})})}),e.jsx(n.Box,{flex:1,marginX:1,children:e.jsx(it,{prefix:e.jsx(n.Box,{padding:1,children:e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"loaded"===u.status?I("preview-frame.refresh-button.tooltip"):I("preview-frame.status",{context:u.status})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":I("preview-frame.refresh-button.aria-label"),fontSize:1,icon:c.RefreshIcon,mode:"bleed",loading:"reloading"===u.status||"refreshing"===u.status,onClick:F,padding:2})})}),onChange:h,origin:A,suffix:e.jsx(n.Box,{padding:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:c.ShareIcon,mode:"bleed",padding:2,space:2}),id:"location-menu",menu:e.jsx(n.Menu,{children:e.jsx(st,{initialUrl:l,openPopup:g,previewLocationOrigin:A,previewLocationRoute:G})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),value:G})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,padding:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:c.ChevronDownIcon,mode:"bleed",padding:2,space:2,text:I(ct["connected"===f?x:"previewDrafts"]),loading:"reconnecting"===f&&"loaded"!==u.status,disabled:"connected"!==f}),id:"perspective-menu",menu:e.jsxs(n.Menu,{style:{maxWidth:240},children:[e.jsx(n.MenuItem,{fontSize:1,onClick:()=>w("previewDrafts"),padding:3,pressed:"previewDrafts"===x,tone:ut,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(dt.previewDrafts)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:I(ct.previewDrafts)}),e.jsx(n.Text,{muted:!0,size:1,children:I("preview-frame.perspective.previewDrafts.text")})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===x?1:0},children:e.jsx(c.CheckmarkIcon,{})})})]})}),e.jsx(n.MenuItem,{fontSize:1,onClick:()=>w("published"),padding:3,pressed:"published"===x,tone:lt,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(dt.published)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:I(ct.published)}),e.jsx(n.Text,{muted:!0,size:1,children:I("preview-frame.perspective.published.text")})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"published"===x?1:0},children:e.jsx(c.CheckmarkIcon,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:I("preview-frame.viewport-button.tooltip",{context:"desktop"===E?"narrow":"full"})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":I("preview-frame.viewport-button.aria-label"),fontSize:1,icon:"desktop"===E?c.MobileDeviceIcon:c.DesktopIcon,mode:"bleed",onClick:_,padding:2})})})]})}),e.jsx(n.Card,{flex:1,tone:"transparent",children:e.jsxs(n.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===E?0:2,sizing:"border",style:{position:"relative",cursor:U?"wait":void 0},children:[e.jsx(p.AnimatePresence,{children:$||z||L||!V||q?(z||"connecting"===y&&"refreshing"!==u.status)&&!q?e.jsx(ot,{initial:"initial",animate:"animate",exit:"exit",variants:mt,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:e.jsxs(n.Flex,{style:{...ft[E]},justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:I("preview-frame.status",{context:"loading"})})]})}):$&&!q?e.jsx(ot,{initial:"initial",animate:"animate",exit:"exit",variants:ht,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e.jsx(xe,{flex:1,message:I("preview-frame.connection.error.text"),onRetry:B,onContinueAnyway:W,children:T&&e.jsxs(e.Fragment,{children:["connected"!==y&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:I("preview-frame.overlay.connection-status.label")}),e.jsx(n.Code,{size:1,children:I("channel.status",{context:y})})]})}),"connected"!==f&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:I("preview-frame.loader.connection-status.label")}),e.jsx(n.Code,{size:1,children:I("channel.status",{context:f})})]})})]})})}):null:e.jsx(ot,{initial:"initial",animate:"animate",exit:"exit",variants:mt,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:D?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:D?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:e.jsxs(n.Flex,{style:{...ft[E]},justify:"center",align:"center",direction:"column",gap:4,children:[D&&e.jsx(n.Button,{disabled:!0,fontSize:1,mode:"ghost",text:I("preview-frame.continue-button.text"),style:{opacity:0}}),e.jsx(n.Card,{radius:2,tone:D?"caution":"inherit",padding:4,shadow:1,children:e.jsxs(n.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:I("preview-frame.status",D?{context:"timeout"}:{context:"connecting"})})]})}),D&&e.jsx(n.Button,{fontSize:1,tone:"critical",onClick:W,text:I("preview-frame.continue-button.text")})]})})}),e.jsx(rt,{animate:X,initial:["background"],onLoad:H,preventClick:J,ref:s,src:l.toString(),variants:vt})]})})]})})})),ft={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},mt={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},ht={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},vt={desktop:{...ft.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...ft.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};const gt=function(e){const{documentId:t,documentType:n,navigate:s,perspective:a,documentRevision:o}=e,c=i.useEditState(t,n);return function(e,t,n,i,s){const a=r.useRef(i),o=r.useCallback(t,n);r.useEffect((()=>{const t=a.current;if(a.current=e,e!==t)return o(e,t)}),[o,s,e])}(a,(e=>{let t;if("published"===e&&c.published){const{_updatedAt:e,_rev:n}=c.published;t=`${e}/${n}`}o!==t&&s({},{rev:t},!0)}),[c,s,o]),null};let yt=!1;function xt(e,t){return e instanceof Function?e(t):e}function bt(e,t){const n=Array.isArray(e)?e:[e];for(e of n){let n,r=e;if("string"==typeof e)try{const t=new URL(e);n=t.origin,r=t.pathname}catch{}if(!n||t.origin===n)try{const e=h.match(r,{decode:decodeURIComponent})(t.pathname);if(e){const{params:t,path:r}=e;return{origin:n,params:t,path:r}}}catch{throw new Error(`"${e}" is not a valid route pattern`)}}}function wt(e){const{navigate:t,navigationHistory:n,path:a,previewUrl:c,resolvers:u=[]}=e,{state:l}=s.useRouter(),d=i.useClient({apiVersion:o.A}),[p,f]=r.useState(void 0),m=r.useRef(void 0),h=r.useMemo((()=>{const e=a||l._searchParams?.find((([e])=>"preview"===e))?.[1]||"",t="string"==typeof c?c:"object"==typeof c&&c?.origin||location.origin;return new URL(e,t)}),[a,c,l._searchParams]),v=r.useCallback((()=>{f(void 0),m.current=void 0}),[]);return r.useEffect((()=>{if(u.length&&h){let i;for(const e of u){const t=bt(e.route,h);if(t){i={context:t,resolver:e};break}}if(i){const s=function(e,t){if(e.resolve){const n=e.resolve(t)?.filter;return n?`*[${n}][0]{_id, _type}`:void 0}return"type"in e?`*[_type == "${e.type}"][0]{_id, _type}`:`*[${xt(e.filter,t)}][0]{_id, _type}`}(i.resolver,i.context),a=(e=i.resolver,r=i.context,e.resolve?e.resolve(r)?.params??r.params:"type"in e?{}:xt(e.params,r)??r.params);if(s){const e=new AbortController,r={perspective:"previewDrafts",signal:e.signal};return d.fetch(s,a,r).then((e=>{(!e||m.current!==e._id)&&(f({document:e,path:h.pathname}),m.current=e?._id,n.at(-1)?.id===n.at(-2)?.id&&t?.({id:e?._id,type:e?._type}))})).catch((e=>{e instanceof Error&&"AbortError"===e.name||(f({document:void 0,path:h.pathname}),m.current=void 0)})),()=>{e.abort()}}}}var e,r;v()}),[d,v,t,n,u,h]),p}function jt(e){if(void 0===e)return;const t=decodeURIComponent(e)?.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function kt(e){if(void 0!==e)return t.studioPath.toString(function(e){const t=[];for(const n of e.split(".")){const e=H.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=J.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=X.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function Pt(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function St({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:s,frameStateRef:a}){const o=r.useMemo((()=>{const{id:t,path:r,type:i}={id:jt((a=n).id),path:kt(a.path),type:a.type};var a;return{id:t,type:i,path:r,preview:s.preview||`${e.pathname}${e.search}`,perspective:s.perspective,viewport:s.viewport,inspect:s.inspect,rev:s.rev,since:s.since,template:s.template,templateParams:s.templateParams,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment}}),[n,s,e]),c=r.useMemo((()=>Pt({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,templateParams:o.templateParams,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.comment,o.inspect,o.instruction,o.path,o.pathKey,o.rev,o.since,o.template,o.templateParams,o.view]),u=r.useMemo((()=>Pt({perspective:o.perspective,preview:o.preview,viewport:o.viewport})),[o.perspective,o.preview,o.viewport]),l=r.useRef(n);r.useEffect((()=>{l.current=n}),[n]);const[d,p]=r.useState([n]);return{navigate:r.useCallback(((e,n={},r)=>{e.id&&(e.id=i.getPublishedId(e.id));const{_searchParams:s,...o}=l.current,c=(s||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),u=Pt({...o,...e}),d=Pt({...c,...n});o.id!==u.id&&(delete d.template,delete d.templateParams),u._searchParams=Object.entries(d).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const f=r??d.preview===a.current.url;p((e=>[...e,u])),t(u,{replace:f})}),[t,a]),navigationHistory:d,params:o,searchParams:u,structureParams:c}}function Et(e,t,n){const s=i.useClient({apiVersion:o.A}),a=i.useActiveWorkspace(),c=a?.activeWorkspace?.basePath||"/",u=function(e,t,n,s){const[a,o]=r.useState((()=>s||"")),c=r.useRef(0);r.useEffect((()=>{if(a&&s)return window.clearTimeout(c.current),()=>{c.current=window.setTimeout((()=>{o("")}),100)}}),[a,s]);const u=i.useCurrentUser();return r.useMemo((()=>["@sanity/presentation",t,n,e,u?.id,Ct,a]),[t,u?.id,e,n,a])}(t,c,a?.activeWorkspace?.name||"default",n),l=function(e,t){const n=i.useClient({apiVersion:o.A}),s=i.useCurrentUser(),[a,c]=r.useState(""),u=e?g.suspend((async()=>await f.createPreviewSecret(n,"@sanity/presentation",typeof window>"u"?"":location.href,s?.id)),[...t,a]):null;return r.useEffect((()=>{if(!u)return;const e=setTimeout((()=>{r.startTransition((()=>c(u.expiresAt.toString())))}),u.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[u]),u?.secret||null}("object"==typeof e||"function"==typeof e,u);return g.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${c}/`)&&r.pathname!==c?r:t}const t=await("object"==typeof e?v.definePreviewUrl(e):e)({client:s,previewUrlSecret:l,previewSearchParam:n,referrer:typeof document>"u"?null:document.referrer,studioBasePath:c});return new URL(t,location.origin)}),[...u,l])}const Ct=Symbol();const It=r.lazy((()=>Promise.resolve().then((function(){return require("./LoaderQueries.cjs")})))),Tt=r.lazy((()=>Promise.resolve().then((function(){return require("./PostMessageRefreshMutations.cjs")})))),Rt=a.styled(n.Flex)`
  overflow-x: auto;
`;exports.default=function(a){const{previewUrl:c,components:u}=a.tool.options??{},l=a.tool.name||o.D,{unstable_navigator:d}=u||{},{navigate:p,state:f}=s.useRouter(),m=i.useUnique(Object.fromEntries(f._searchParams||[])),h=Et(c||"/",l,m.preview||null),[v]=r.useState((()=>{const e=a.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:typeof window<"u"&&"localhost"===window.location.hostname})),g=r.useMemo((()=>h.origin),[h.origin]),y=r.useRef(null),[b,w]=r.useState(),[j,k]=r.useState({}),P=r.useRef({title:void 0,url:void 0}),{navigate:S,navigationHistory:E,params:C,searchParams:I,structureParams:T}=St({initialPreviewUrl:h,routerNavigate:p,routerState:f,routerSearchParams:m,frameStateRef:P}),R=r.useMemo((()=>ne(S,50)),[S]),[_,z]=r.useReducer(Ke,{},et),M=r.useMemo((()=>C.perspective?"published":"previewDrafts"),[C.perspective]),L=r.useMemo((()=>C.viewport?"mobile":"desktop"),[C.viewport]),[$,O]=function(e,t){if("published"!==e&&"previewDrafts"!==e)throw new Error(`Invalid perspective: ${e}`);const[n,i]=r.useState({}),[s,a]=r.useState({}),o=r.useRef(""),c=r.useCallback(((e,n,r=[])=>{const s=r.filter((e=>"_projectId"in e&&e._projectId?(yt||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),yt=!0),!1):e));("published"===n?i:a)((n=>{const r={};for(const e of s)r[e._id]=e;if(o.current!==t.current.url)return o.current=t.current.url,{[e]:r};const i=n[e];return x.default(i,r)?n:{...n,[e]:r}}))}),[t]);return[r.useMemo((()=>{const t=Object.values("published"===e?n:s).reduce(((e,t)=>(Object.values(t).forEach((t=>{e[t._id]=t})),e)),{});return Object.values(t)}),[e,s,n]),c]}(M,P),U=i.useProjectId(),A=i.useDataset(),F=wt({navigate:S,navigationHistory:E,path:C.preview,previewUrl:a.tool.options?.previewUrl,resolvers:a.tool.options?.resolve?.mainDocuments}),[B,W]=r.useState("connecting"),[q,N]=r.useState("connecting"),[V,K]=r.useState("connecting"),[G]=r.useState((()=>new Set)),H=r.useCallback((e=>{const t=window.open(e,"_blank");t&&G.add(t)}),[G]);r.useEffect((()=>{if(G.size&&b)for(const e of G)e&&"closed"in e&&!e.closed&&b.addSource(e)}),[b,G,G.size]),r.useEffect((()=>{const e=y.current?.contentWindow;if(!e)return;const t=function(e){const{destroy:t,send:n}=D(e),r=new Set,i=new WeakMap,s=new Set;return{destroy:()=>{t();for(const e of s)e()},send:(e,...t)=>{n(e,...t);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,...t)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=D({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(...e)=>{const[t]=e;if("preview-kit/documents"!==t&&"overlay/navigate"!==t&&"loader/documents"!==t)return n(...e)}:void 0}}))});s.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:e,targetOrigin:g,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:W,onEvent(e,t){if("visual-editing/focus"!==e&&"overlay/focus"!==e||!("id"in t))if("visual-editing/navigate"===e||"overlay/navigate"===e){const{title:e,url:n}=t;P.current.url!==n&&R({},{preview:n}),P.current={title:e,url:n}}else"visual-editing/meta"===e?P.current.title=t.title:"visual-editing/toggle"===e||"overlay/toggle"===e?z({type:Ve,enabled:t.enabled}):"visual-editing/documents"===e?O("visual-editing",t.perspective,t.documents):"visual-editing/refreshing"===e&&"manual"===t.source?clearTimeout(pe.current):"visual-editing/refreshing"===e&&"mutation"===t.source?z({type:qe}):"visual-editing/refreshed"===e&&z({type:We});else R({type:t.type,id:t.id,path:t.path})}},{id:"loaders",heartbeat:!0,onStatusUpdate:N,onEvent(e,t){if("loader/documents"===e&&t.projectId===U&&t.dataset===A)O("loaders",t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===U&&t.dataset===A){if("number"==typeof t.heartbeat&&t.heartbeat<o.c)throw new Error(`Loader query listen heartbeat interval must be at least ${o.c}ms`);k((e=>({...e,[Y(t.query,t.params)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:t.heartbeat??!1}})))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:K,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===U&&t.dataset===A&&O("preview-kit",t.perspective,t.documents)}}]});return w(t),()=>{t.destroy(),w(void 0)}}),[A,U,O,R,g]),r.useEffect((()=>{const e=setInterval((()=>k((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))),o.c);return()=>clearInterval(e)}),[]);const J=r.useCallback((e=>{R({path:t.studioPath.toString(e)},{},!0)}),[R]),X=r.useCallback((e=>{const t=new URL(e,h.origin),n=t.pathname+t.search;t.origin===h.origin&&n!==C.preview&&R({},{preview:n})}),[h,C,R]),Z=r.useCallback((e=>{R({},e)}),[R]);r.useEffect((()=>{b?.send("overlays","presentation/perspective",{perspective:M})}),[b,M]),r.useEffect((()=>{C.id&&C.path?b?.send("overlays","presentation/focus",{id:C.id,path:C.path}):b?.send("overlays","presentation/blur",void 0)}),[b,C.id,C.path]),r.useEffect((()=>{P.current.url&&C.preview&&P.current.url!==C.preview&&(P.current.url=C.preview,"connected"!==B&&y.current?y.current.src=`${g}${C.preview}`:b?.send("overlays","presentation/navigate",{url:C.preview,type:"replace"}))}),[b,B,g,C.preview]);const Q=r.useCallback((()=>b?.send("overlays","presentation/toggleOverlay",void 0)),[b]),[re,ie]=r.useState(null);r.useEffect((()=>{const e=e=>{te(e)&&Q()},t=e=>{var t;te(e)&&Q(),t=e,["mod","\\"].every((e=>ee[e]?t[ee[e]]:t.key===e.toUpperCase()))&&Q()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[Q]);const[ae,oe]=r.useState(null),[{navigatorEnabled:ce,toggleNavigator:ue},le]=Ue({unstable_navigator:d}),de=r.useRef(C.id);r.useEffect((()=>{C.rev&&de.current&&C.id!==de.current&&R({},{rev:void 0}),de.current=C.id}));const pe=r.useRef(),fe=r.useCallback((e=>{if(z({type:qe}),b)return pe.current=window.setTimeout(e,300),void b.send("overlays","presentation/refresh",{source:"manual",livePreviewEnabled:"connected"===V||"connected"===q});e()}),[b,q,V]),me=i.useWorkspace(),he=r.useCallback((({id:e,type:t,path:n})=>{if(P.current.url)return{title:P.current.title||P.current.url,name:"edit",params:{id:e,path:n,type:t,inspect:o.C,workspace:me.name,mode:o.E,preview:C.preview}}}),[C.preview,me.name]),ve=r.useCallback((e=>{R({},{viewport:"desktop"===e?void 0:"mobile"},!0)}),[R]),ge=r.useCallback((e=>{R({},{perspective:"previewDrafts"===e?void 0:e})}),[R]);return e.jsxs(e.Fragment,{children:[e.jsx(Be,{devMode:v,name:l,navigate:R,params:C,searchParams:I,structureParams:T,children:e.jsx(Oe,{navigate:R,children:e.jsx(Fe,{params:C,children:e.jsx(Rt,{height:"fill",children:e.jsxs(ye,{children:[e.jsx(le,{}),e.jsx(se,{id:"preview",minWidth:325,defaultSize:ce?50:75,order:3,children:e.jsx(n.Flex,{direction:"column",flex:1,height:"fill",ref:oe,children:e.jsx(n.BoundaryElementProvider,{element:ae,children:e.jsx(pt,{dispatch:z,iframe:_.iframe,initialUrl:h,loadersConnection:q,navigatorEnabled:ce,onPathChange:X,onRefresh:fe,openPopup:H,overlaysConnection:B,previewUrl:C.preview,perspective:M,ref:y,setPerspective:ge,setViewport:ve,targetOrigin:g,toggleNavigator:ue,toggleOverlay:Q,viewport:L,visualEditing:_.visualEditing})})})}),e.jsx($e,{documentId:C.id,documentsOnPage:$,documentType:C.type,getCommentIntent:he,mainDocumentState:F,onFocusPath:J,onStructureParams:Z,searchParams:I,setDisplayedDocument:ie,structureParams:T})]})})})})}),b&&e.jsx(r.Suspense,{children:e.jsx(It,{channel:b,liveQueries:j,perspective:M,liveDocument:re,documentsOnPage:$})}),b&&C.id&&C.type&&e.jsx(r.Suspense,{children:e.jsx(Tt,{channel:b,id:C.id,type:C.type,loadersConnection:q,previewKitConnection:V})}),C.id&&C.type&&e.jsx(gt,{documentId:C.id,documentRevision:C.rev,documentType:C.type,navigate:R,perspective:M})]})};//# sourceMappingURL=PresentationTool.cjs.map
